<!DOCTYPE html>
<html lang="ko">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSA Coffee</title>
    <!-- icon setting -->
    <link rel="icon" sizes="192x192" href="./pic/website_icon.png">
    <link rel="apple-touch-icon" href="./pic/website_icon.png">
    <meta name="msapplication-square70x70logo" content="./pic/website_icon.png">
    <!-- Safari meta data setting -->
    <meta name="apple-mobile-web-app-title" content="í† ì°Œì¹´í˜">
    <meta name="apple-mobile-web-app-capable" content="yes"/>

    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
          integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
</head>


<body>
<!-- top bar area -->
<header>
    <h1 class="hidden-title" hidden>Startbucks</h1> <!-- hidden -->
    <div class="header_col1-top-title">
        <div class="top-left-icon">
            <a href="#"><i class="icon-bell"></i></a>
        </div>
        <span class="top-title">
            ì´ë¦„ : <input id="userName" type="text"/> <br/>

        </span>

        <div class="top-right-icon">
            <a href="#"><i class="icon-search"></i></a>
        </div>
    </div>
</header>

<section>

</section>


<!--    1 ì„¹ì…˜-->
<section>

    <div class="discount-title">
        <h2>ì£¼ë¬¸ë‚´ì—­</h2>
        <span>ì „ì²´ë³´ê¸°<i class="icon-angle-right"></i></span>
    </div>
    <div id="ordered">
        <br>

    </div>
</section>


<!--    2 ì„¹ì…˜-->
<section>
    <div class="discount-title">
        <h2>ë©”ë‰´</h2>
        <span>ì „ì²´ë³´ê¸°<i class="icon-angle-right"></i></span>
    </div>

    <div class="section_col5-align">

        <button class="button" type="button" id="iceamericano">
            <img src="./pic/mini1.png"/>ì•„ë©”ë¦¬ì¹´ë…¸
        </button>


        <button class="button" type="button" id="latte">
            <img src="./pic/mini5.png"/>ë¼ë–¼
        </button>


        <button class="button" type="button" id="ade">
            <img src="./pic/mini8.png"/>ì—ì´ë“œ
        </button>

    </div>

</section>

<!--    3 ì„¹ì…˜-->
<section>
    <div class="discount-title">
        <h2>ì¥ë°”êµ¬ë‹ˆ</h2>
    </div>
    <div id="keep">
        <br>
    </div>
    <div>
        <span>ì „ì²´ë³´ê¸°<i class="icon-angle-right"></i></span>
        <button id="order" class="order-button" onclick="sendOrder()">ì£¼ë¬¸í•˜ê¸°</button>
    </div>
</section>


<!--<footer>-->
<!--    <div class="policy-area">-->
<!--        <span>ì‚¬ì—…ìì •ë³´í™•ì¸</span>-->
<!--        <span>ì´ìš©ì•½ê´€</span>-->
<!--        <span>ì „ìê¸ˆìœµê±°ë˜ì´ìš©ì•½ê´€</span>-->
<!--        <span class="privacy-policy">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</span>-->
<!--    </div>-->
<!--</footer>-->

<!--<nav>-->
<!--    <a href="#"><i class="icon-home active-navigator"></i>í™ˆ</a>-->
<!--    <a href="#"><i class="icon-search"></i>ê²€ìƒ‰</a>-->
<!--    <a href="#"><i class="icon-heart"></i>ë‚´ ë©”ë‰´</a>-->
<!--    <a href="#"><i class="icon-list"></i>ì£¼ë¬¸ë‚´ì—­</a>-->
<!--    <a href="#"><i class="icon-smile"></i>my</a>-->
<!--</nav>-->
</body>

<script>
    let keep = document.getElementById("keep");
    let ordered = document.getElementById("ordered");
    let order_id="";
    let menu = "menu";
    iceamericano_btn = document.getElementById('iceamericano');
    latte_btn = document.getElementById('latte');
    ade_btn = document.getElementById('ade');


    iceamericano_btn.onclick = function () {
        menu += ",iceamericano";
        console.log(menu);

        if (keep.innerHTML.includes("ì•„ë©”ë¦¬ì¹´ë…¸")) {
            let iceamericano_text = document.getElementById("iceamericano_text").innerText;
            let icaamericano_num = Number(iceamericano_text.split("X")[1]) + Number(1);
            document.getElementById("iceamericano_text").innerText = "ì•„ë©”ë¦¬ì¹´ë…¸ X " + icaamericano_num;
            console.log(icaamericano_num);
        } else {
            console.log("1ë²ˆì¨°");
            keep.innerHTML = keep.innerHTML + "<div class='section_x-slide-area'><ul><div class='notice'><div class='section_y-slide-area'><span id='iceamericano_text'>ì•„ë©”ë¦¬ì¹´ë…¸ X 1</span><br></div></div></ul></div>";
        }


    };

    latte_btn.onclick = function () {
        menu += ",latte";
        console.log(menu);

        if (keep.innerHTML.includes("ë¼ë–¼")) {
            let latte_text = document.getElementById("latte_text").innerText;
            let latte_num = Number(latte_text.split("X")[1]) + Number(1);
            document.getElementById("latte_text").innerText = "ë¼ë–¼ X " + latte_num;
            console.log(latte_num);
        } else {
            console.log("1ë²ˆì¨°");
            keep.innerHTML = keep.innerHTML + "<div class='section_x-slide-area'><ul><div class='notice'><div class='section_y-slide-area'><span id='latte_text'>ë¼ë–¼ X 1</span><br></div></div></ul></div>";
        }

    };
    ade_btn.onclick = function () {
        menu += ",ade";
        console.log(menu);
        if (keep.innerHTML.includes("ì—ì´ë“œ")) {
            let ade_text = document.getElementById("ade_text").innerText;
            let ade_num = Number(ade_text.split("X")[1]) + Number(1);
            document.getElementById("ade_text").innerText = "ì—ì´ë“œ X " + ade_num;
            console.log(ade_num);
        } else {
            console.log("1ë²ˆì¨°");
            keep.innerHTML = keep.innerHTML + "<div class='section_x-slide-area'><ul><div class='notice'><div class='section_y-slide-area'><span id='ade_text'>ì—ì´ë“œ X 1</span><br></div></div></ul></div>";
        }

    };

    // order.onclick = function () {
    //     console.log(menu);
    // };

    function sendOrder() {
        var httpRequest = new XMLHttpRequest();
        ordered.innerHTML = keep.innerHTML +  "<div class='section_x-slide-area'><ul><div class='notice'><div class='section_y-slide-area'><span id='status_text'>ì¤€ë¹„ì¤‘â˜•â€¦ğŸˆ</span><br></div></div></ul></div>";;
        keep.innerHTML = "<br>";

        httpRequest.onreadystatechange = function () {
            if (httpRequest.readyState == XMLHttpRequest.DONE && httpRequest.status == 200) {
                var json = JSON.parse(httpRequest.responseText);
                order_id = json.resultVO._id;
                checkStatus();
            }
        };
        httpRequest.open("POST", "http://192.168.1.103:32016/api/v1/order", true);
        httpRequest.setRequestHeader("Content-Type", "application/json");
        console.log("{\"_id\":\"string\",\"orderName\":\"" + menu + "\",\"userId\":\"string\",\"userName\":\"" + document.getElementById('userName').value + "\"}");
        httpRequest.send("{\"_id\":\"string\",\"orderName\":\"" + menu + "\",\"userId\":\"string\",\"userName\":\"" + document.getElementById('userName').value + "\"}");
    }




    function checkStatus() {
        console.log(order_id);
        var httpRequest = new XMLHttpRequest();

        httpRequest.onreadystatechange = function () {
            if (httpRequest.readyState == XMLHttpRequest.DONE && httpRequest.status == 200) {
                var json = JSON.parse(httpRequest.responseText);

                for (var result in json.resultVO) {
                    if (json.resultVO[result].orderId == order_id) {
                        console.log(json.resultVO[result].statusName);
                        if(json.resultVO[result].statusName==='DONE') {
                            document.getElementById("status_text").innerText="ì™„ì„±â˜•ï¸ğŸˆ";
                        }
                    }
                }
            }
        };

        httpRequest.open("GET", "http://192.168.1.103:32016/api/v1/status", true);
        httpRequest.setRequestHeader("Content-Type", "application/json");
        httpRequest.send();

        setTimeout(checkStatus, 3000);
    };



</script>

</html>